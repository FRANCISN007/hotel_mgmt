{"ast":null,"code":"// src/contexts/AuthContext.js\nimport React,{createContext,useState,useEffect}from\"react\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[authToken,setAuthToken]=useState(null);const[user,setUser]=useState(null);const navigate=useNavigate();useEffect(()=>{// Check for token in local storage on app load\nconst token=localStorage.getItem(\"authToken\");if(token){setAuthToken(token);fetchUserDetails(token);}},[]);const login=async(username,password)=>{try{const response=await fetch(\"http://127.0.0.1:8000/user/token\",{method:\"POST\",headers:{\"Content-Type\":\"application/x-www-form-urlencoded\"},body:new URLSearchParams({username,password})});if(response.ok){const data=await response.json();setAuthToken(data.access_token);localStorage.setItem(\"authToken\",data.access_token);fetchUserDetails(data.access_token);navigate(\"/\");}else{alert(\"Invalid credentials. Please try again.\");}}catch(error){console.error(\"Login error:\",error);}};const logout=()=>{setAuthToken(null);setUser(null);localStorage.removeItem(\"authToken\");navigate(\"/login\");};const fetchUserDetails=async token=>{try{const response=await fetch(\"http://127.0.0.1:8000/user/details\",{headers:{Authorization:\"Bearer \".concat(token)}});if(response.ok){const userData=await response.json();setUser(userData);}else{logout();// Token may have expired\n}}catch(error){console.error(\"Error fetching user details:\",error);}};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{authToken,user,login,logout},children:children});};export const useAuth=()=>React.useContext(AuthContext);","map":{"version":3,"names":["React","createContext","useState","useEffect","useNavigate","jsx","_jsx","AuthContext","AuthProvider","_ref","children","authToken","setAuthToken","user","setUser","navigate","token","localStorage","getItem","fetchUserDetails","login","username","password","response","fetch","method","headers","body","URLSearchParams","ok","data","json","access_token","setItem","alert","error","console","logout","removeItem","Authorization","concat","userData","Provider","value","useAuth","useContext"],"sources":["C:/Users/hp/Documents/MYPROJECT/HOTEL MGMT SYS/hotel-management-frontend/src/contexts/AuthContext.js"],"sourcesContent":["// src/contexts/AuthContext.js\r\nimport React, { createContext, useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [authToken, setAuthToken] = useState(null);\r\n  const [user, setUser] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    // Check for token in local storage on app load\r\n    const token = localStorage.getItem(\"authToken\");\r\n    if (token) {\r\n      setAuthToken(token);\r\n      fetchUserDetails(token);\r\n    }\r\n  }, []);\r\n\r\n  const login = async (username, password) => {\r\n    try {\r\n      const response = await fetch(\"http://127.0.0.1:8000/user/token\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n        body: new URLSearchParams({ username, password }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setAuthToken(data.access_token);\r\n        localStorage.setItem(\"authToken\", data.access_token);\r\n        fetchUserDetails(data.access_token);\r\n        navigate(\"/\");\r\n      } else {\r\n        alert(\"Invalid credentials. Please try again.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Login error:\", error);\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    setAuthToken(null);\r\n    setUser(null);\r\n    localStorage.removeItem(\"authToken\");\r\n    navigate(\"/login\");\r\n  };\r\n\r\n  const fetchUserDetails = async (token) => {\r\n    try {\r\n      const response = await fetch(\"http://127.0.0.1:8000/user/details\", {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      if (response.ok) {\r\n        const userData = await response.json();\r\n        setUser(userData);\r\n      } else {\r\n        logout(); // Token may have expired\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching user details:\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ authToken, user, login, logout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => React.useContext(AuthContext);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}